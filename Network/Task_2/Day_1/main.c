#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define Segment_Size 64

unsigned char headCheckData[Segment_Size] = {
	// Offset 0x00000000 to 0x0000003F
	0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00, 0x00, 0x0D,
	0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x04, 0x38, 0x00, 0x00, 0x05, 0xF7,
	0x08, 0x06, 0x00, 0x00, 0x00, 0xAA, 0xD9, 0xCB, 0x5A, 0x00, 0x00, 0x00,
	0x04, 0x67, 0x41, 0x4D, 0x41, 0x00, 0x00, 0xB1, 0x8F, 0x0B, 0xFC, 0x61,
	0x05, 0x00, 0x00, 0x00, 0x20, 0x63, 0x48, 0x52, 0x4D, 0x00, 0x00, 0x7A,
	0x26, 0x00, 0x00, 0x80
};
unsigned char tailCheckData[Segment_Size] = {
	// Offset 0x00087BA2 to 0x00087BE1
	0xD1, 0x99, 0xD6, 0x13, 0x3A, 0x71, 0x85, 0x3C, 0xD4, 0x8A, 0xC6, 0xA0,
	0xF8, 0xEB, 0x4D, 0x82, 0x83, 0xDB, 0xCB, 0x38, 0x68, 0x44, 0x9F, 0xC3,
	0xBA, 0x22, 0xA5, 0x90, 0xD6, 0x1C, 0x2B, 0x50, 0xD5, 0x44, 0x27, 0xD6,
	0x33, 0xD4, 0x30, 0xA8, 0x9D, 0xBD, 0xFE, 0x02, 0x36, 0x83, 0xA3, 0xC8,
	0x10, 0x57, 0x8C, 0x76, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44,
	0xAE, 0x42, 0x60, 0x82
};

#define CheckSegment(_ck_seg_name, _ck_data_name, _ck_size) \
printf( #_ck_seg_name ": %s\n", memcmp(_ck_seg_name, _ck_data_name, _ck_size)?"failed":"passed")

unsigned char head[Segment_Size], tail[Segment_Size];

/// Print in hexadecimal format.
inline void hexPrint(int count, const unsigned char *buf) {
	if (!buf || !count)return;
	const unsigned char* ptr = buf, 
					   * end = ptr + count;

	while (1) {
		printf( "%.2X", *ptr );
		++ptr;
		if (ptr == end) break;
		putchar(' ');
	}
}

#define NoRedirect

int main() {
	FILE* stream = NULL;
	// Read
	stream = fopen( "source.png", "rb" );
	if (!stream) {
		fprintf( stderr, "Open failed (source.png) : %s\n", strerror(errno) );
		exit( 1 );
	}

	fseek( stream, 0, SEEK_SET );
	fread( head, 1, sizeof(head), stream );

	fseek( stream, -(int)sizeof(tail), SEEK_END );
	fread( tail, 1, sizeof(tail), stream );
	
	fclose( stream );
	printf( "Successfully read binary file.\n" );

	// Print
#ifndef NoRedirect
	if (!freopen("output.txt", "wt", stdout)) {
		fprintf(stderr, "Open failed (output.txt) : %s\n", strerror(errno));
		exit(1);
	}
#endif

	hexPrint( sizeof(head), head );
	printf( "\n" );
	hexPrint( sizeof(tail), tail );
	printf( "\n" );

#ifndef NoRedirect
	if (freopen("con", "w", stdout)) {
		printf("Read output.txt for details.\n");
	}
#endif

	//Check
	CheckSegment(head, headCheckData, sizeof(head));
	CheckSegment(tail, tailCheckData, sizeof(tail));

	// Exit
	return 0;
}
